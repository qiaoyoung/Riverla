
#import <Foundation/Foundation.h>

NSString *StringFromMarginCocaineData(Byte *data);


//: menu_forword
Byte kStr_lungReverseData[] = {15, 12, 19, 6, 244, 83, 128, 120, 129, 136, 114, 121, 130, 133, 138, 130, 133, 119, 79};


//: onTapMenuItemReply:
Byte kStr_freedomText[] = {38, 19, 6, 10, 200, 224, 155, 21, 198, 117, 117, 116, 90, 103, 118, 83, 107, 116, 123, 79, 122, 107, 115, 88, 107, 118, 114, 127, 64, 144};


//: onTapMenuItemReport:
Byte kStr_assaultValue[] = {47, 20, 62, 7, 126, 140, 33, 173, 172, 146, 159, 174, 139, 163, 172, 179, 135, 178, 163, 171, 144, 163, 174, 173, 176, 178, 120, 233};


//: report_Content
Byte kStr_stareDireName[] = {67, 14, 44, 12, 20, 204, 74, 255, 225, 116, 7, 111, 158, 145, 156, 155, 158, 160, 139, 111, 155, 154, 160, 145, 154, 160, 3};


//: menu_del
Byte kStr_reluctantTitle[] = {73, 8, 72, 10, 155, 14, 160, 21, 185, 173, 181, 173, 182, 189, 167, 172, 173, 180, 228};


//: onTapMenuItemRevoke:
Byte kStr_intentionData[] = {3, 20, 20, 12, 250, 138, 28, 8, 205, 248, 167, 215, 131, 130, 104, 117, 132, 97, 121, 130, 137, 93, 136, 121, 129, 102, 121, 138, 131, 127, 121, 78, 211};


//: menu_translation
Byte kStr_automatName[] = {71, 16, 22, 9, 225, 136, 148, 20, 245, 131, 123, 132, 139, 117, 138, 136, 119, 132, 137, 130, 119, 138, 127, 133, 132, 84};


//: menu_reply
Byte kStr_conclusionTextDateName[] = {72, 10, 65, 6, 129, 162, 174, 166, 175, 182, 160, 179, 166, 177, 173, 186, 52};


//: onTapMenuItemPraise:
Byte kStr_materBedroomValue[] = {9, 20, 34, 7, 24, 221, 33, 145, 144, 118, 131, 146, 111, 135, 144, 151, 107, 150, 135, 143, 114, 148, 131, 139, 149, 135, 92, 43};


//: menu_copy
Byte kStr_tubValue[] = {42, 9, 36, 14, 14, 104, 136, 47, 52, 34, 8, 35, 136, 250, 145, 137, 146, 153, 131, 135, 147, 148, 157, 111};


//: menu_revoke
Byte kStr_bishopPureValue[] = {73, 11, 40, 11, 24, 249, 111, 245, 39, 89, 122, 149, 141, 150, 157, 135, 154, 141, 158, 151, 147, 141, 189};


//: onTapMenuItemForword:
Byte kStr_learnValue[] = {3, 21, 27, 5, 230, 138, 137, 111, 124, 139, 104, 128, 137, 144, 100, 143, 128, 136, 97, 138, 141, 146, 138, 141, 127, 85, 68};


//: onTapMenuItemDelete:
Byte kStr_albumWithValue[] = {50, 20, 91, 13, 207, 211, 72, 248, 244, 82, 129, 37, 10, 202, 201, 175, 188, 203, 168, 192, 201, 208, 164, 207, 192, 200, 159, 192, 199, 192, 207, 192, 149, 17};


//: onTapMenuItemCopy:
Byte kStr_scoreTitle[] = {14, 18, 89, 13, 203, 60, 174, 81, 155, 44, 202, 84, 45, 200, 199, 173, 186, 201, 166, 190, 199, 206, 162, 205, 190, 198, 156, 200, 201, 210, 147, 112};


//: onTapMenuItemTranslation:
Byte kStr_gangQuickData[] = {87, 25, 71, 12, 106, 83, 215, 4, 51, 218, 77, 153, 182, 181, 155, 168, 183, 148, 172, 181, 188, 144, 187, 172, 180, 155, 185, 168, 181, 186, 179, 168, 187, 176, 182, 181, 129, 2};


//: menu_praise
Byte kStr_extendedName[] = {17, 11, 36, 12, 247, 160, 251, 131, 124, 174, 171, 104, 145, 137, 146, 153, 131, 148, 150, 133, 141, 151, 137, 9};


//: friend_circle_adapter_like
Byte kStr_aleName[] = {57, 26, 44, 10, 224, 172, 27, 73, 224, 14, 146, 158, 149, 145, 154, 144, 139, 143, 149, 158, 143, 152, 145, 139, 141, 144, 141, 156, 160, 145, 158, 139, 152, 149, 151, 145, 214};


//: menu_report
Byte kStr_messageLeaseData[] = {38, 11, 31, 4, 140, 132, 141, 148, 126, 145, 132, 143, 142, 145, 147, 180};

// __DEBUG__
// __CLOSE_PRINT__
//
//  NameApp.m
//  NIM
//
//  Created by amao on 8/11/15.
//  Copyright (c) 2015 Netease. All rights reserved.
//

// __M_A_C_R_O__
//: #import "NTESSessionConfig.h"
#import "NameApp.h"
//: #import "FFFMediaItem.h"
#import "ChangeMax.h"
//: #import "NTESBundleSetting.h"
#import "PinStyle.h"
//: #import "NTESSnapchatAttachment.h"
#import "PresentAttachment.h"
//: #import "NTESWhiteboardAttachment.h"
#import "PastAttachment.h"
//: #import "NTESBundleSetting.h"
#import "PinStyle.h"
//: #import "NSString+NTES.h"
#import "NSString+InfoByMargin.h"
//: #import "FFFSessionConfig.h"
#import "BlueConfig.h"
//: #import "NTESSessionUtil.h"
#import "LinkUtil.h"
//: #import "FFFInputEmoticonManager.h"
#import "AppManager.h"
//: #import "FFFKitUtil.h"
#import "UtilizerUtil.h"

//: @interface NTESSessionConfig()
@interface NameApp()
//: @property (nonatomic,strong) NIMMessage *threadMessage;
@property (nonatomic,strong) NIMMessage *threadMessage;
//: @end
@end

//: @implementation NTESSessionConfig
@implementation NameApp

//: - (NSArray *)mediaItems
- (NSArray *)showMedia
{
    //: NSArray *defaultMediaItems = [MyUserKit sharedKit].config.defaultMediaItems;
    NSArray *defaultMediaItems = [Notice fullKit].config.buildImage;

//    ChangeMax *janKenPon = [ChangeMax item:@"onTapMediaItemJanKenPon:"
//                                     normalImage:[UIImage imageNamed:@"icon_jankenpon_normal"]
//                                   selectedImage:[UIImage imageNamed:@"icon_jankenpon_pressed"]
//                                           title:LangKey(@"message_send_RPS")];//@"石头剪刀布".ntes_localized

//    ChangeMax *fileTrans = [ChangeMax item:@"onTapMediaItemFileTrans:"
//                                                normalImage:[UIImage imageNamed:@"icon_file_trans_normal"]
//                                              selectedImage:[UIImage imageNamed:@"icon_file_trans_pressed"]
//                                           title:LangKey(@"message_send_transfer")];//@"文件传输".ntes_localized

//    ChangeMax *tip       = [ChangeMax item:@"onTapMediaItemTip:"
//                                     normalImage:[UIImage imageNamed:@"bk_media_tip_normal"]
//                                   selectedImage:[UIImage imageNamed:@"bk_media_tip_pressed"]
//                                           title:@"提示消息".ntes_localized];

//    ChangeMax *audioChat =  [ChangeMax item:@"onTapMediaItemAudioChat:"
//                                      normalImage:[UIImage imageNamed:@"btn_media_telphone_message_normal"]
//                                    selectedImage:[UIImage imageNamed:@"btn_media_telphone_message_pressed"]
//                                           title:LangKey(@"message_send_voice_chat")];//@"实时语音".ntes_localized
//
//    ChangeMax *videoChat =  [ChangeMax item:@"onTapMediaItemVideoChat:"
//                                      normalImage:[UIImage imageNamed:@"btn_bk_media_video_chat_normal"]
//                                    selectedImage:[UIImage imageNamed:@"btn_bk_media_video_chat_pressed"]
//                                            title:LangKey(@"message_send_video_chat")];//@"视频聊天".ntes_localized
//
//    ChangeMax *teamMeeting =  [ChangeMax item:@"onTapMediaItemTeamMeeting:"
//                                      normalImage:[UIImage imageNamed:@"btn_media_telphone_message_normal"]
//                                    selectedImage:[UIImage imageNamed:@"btn_media_telphone_message_pressed"]
//                                            title:LangKey(@"message_send_video_chat")];//@"视频通话".ntes_localized

//    ChangeMax *snapChat =   [ChangeMax item:@"onTapMediaItemSnapChat:"
//                                      normalImage:[UIImage imageNamed:@"bk_media_snap_normal"]
//                                    selectedImage:[UIImage imageNamed:@"bk_media_snap_pressed"]
//                                            title:@"阅后即焚".ntes_localized];

//    ChangeMax *whiteBoard = [ChangeMax item:@"onTapMediaItemWhiteBoard:"
//                                      normalImage:[UIImage imageNamed:@"btn_whiteboard_invite_normal"]
//                                    selectedImage:[UIImage imageNamed:@"btn_whiteboard_invite_pressed"]
//
//                                            title:@"白板".ntes_localized];
    //红包功能因合作终止，暂时关闭
//    ChangeMax *redPacket  = [ChangeMax item:@"onTapMediaItemRedPacket:"
//                                      normalImage:[UIImage imageNamed:@"icon_redpacket_normal"]
//                                    selectedImage:[UIImage imageNamed:@"icon_redpacket_pressed"]
//                                            title:LangKey(@"message_send_red_packet")];//@"红包"

//    ChangeMax *teamReceipt  = [ChangeMax item:@"onTapMediaItemTeamReceipt:"
//                                      normalImage:[UIImage imageNamed:@"icon_team_receipt_normal"]
//                                    selectedImage:[UIImage imageNamed:@"icon_team_receipt_pressed"]
//                                            title:@"已读回执".ntes_localized];



//    BOOL isMe   = _session.sessionType == NIMSessionTypeP2P
//    && [_session.sessionId isEqualToString:[[NIMSDK sharedSDK].loginManager currentAccount]];
//    NSArray *items = nil;

//    if (isMe)
//    {
//        items = @[janKenPon,tip];
//    }
//    else if(_session.sessionType == NIMSessionTypeTeam || _session.sessionType == NIMSessionTypeSuperTeam)
//    {
//        items = @[janKenPon];
//    }
//    else
//    {
//        items = @[janKenPon];
//    }


//    return [defaultMediaItems arrayByAddingObjectsFromArray:items];
    //: return defaultMediaItems;
    return defaultMediaItems;
}


//: - (NSArray<FFFMediaItem *> *)menuItemsWithMessage:(NIMMessage *)message {
- (NSArray<ChangeMax *> *)colorMessage:(NIMMessage *)message {
    //: NSMutableArray *items = [NSMutableArray array];
    NSMutableArray *items = [NSMutableArray array];

    //: FFFMediaItem *Praise = [FFFMediaItem item:@"onTapMenuItemPraise:"
    ChangeMax *Praise = [ChangeMax show:StringFromMarginCocaineData(kStr_materBedroomValue)
                                 //: normalImage:[UIImage imageNamed:@"menu_praise"]
                                 that:[UIImage imageNamed:StringFromMarginCocaineData(kStr_extendedName)]
                               //: selectedImage:nil
                               from:nil
                                       //: title:[FFFLanguageManager getTextWithKey:@"friend_circle_adapter_like"]];
                                       tillTing:[TeamManager sizeKey:StringFromMarginCocaineData(kStr_aleName)]];

    //: FFFMediaItem *reply = [FFFMediaItem item:@"onTapMenuItemReply:"
    ChangeMax *reply = [ChangeMax show:StringFromMarginCocaineData(kStr_freedomText)
                                 //: normalImage:[UIImage imageNamed:@"menu_reply"]
                                 that:[UIImage imageNamed:StringFromMarginCocaineData(kStr_conclusionTextDateName)]
                               //: selectedImage:nil
                               from:nil
                                       //: title:[FFFLanguageManager getTextWithKey:@"回复"]];
                                       tillTing:[TeamManager sizeKey:@"回复"]];

    //: FFFMediaItem *copy = [FFFMediaItem item:@"onTapMenuItemCopy:"
    ChangeMax *copy = [ChangeMax show:StringFromMarginCocaineData(kStr_scoreTitle)
                                //: normalImage:[UIImage imageNamed:@"menu_copy"]
                                that:[UIImage imageNamed:StringFromMarginCocaineData(kStr_tubValue)]
                              //: selectedImage:nil
                              from:nil
                                      //: title:[FFFLanguageManager getTextWithKey:@"复制"]];
                                      tillTing:[TeamManager sizeKey:@"复制"]];

    //: FFFMediaItem *forword = [FFFMediaItem item:@"onTapMenuItemForword:"
    ChangeMax *forword = [ChangeMax show:StringFromMarginCocaineData(kStr_learnValue)
                                   //: normalImage:[UIImage imageNamed:@"menu_forword"]
                                   that:[UIImage imageNamed:StringFromMarginCocaineData(kStr_lungReverseData)]
                                 //: selectedImage:nil
                                 from:nil
                                         //: title:[FFFLanguageManager getTextWithKey:@"转发"]];
                                         tillTing:[TeamManager sizeKey:@"转发"]];

//    ChangeMax *mark = [ChangeMax item:@"onTapMenuItemMark:"
//                                normalImage:[UIImage imageNamed:@"menu_collect"]
//                              selectedImage:nil
//                                      title:LangKey(@"收藏")];

//    BOOL isMessagePined = [NIMSDK.sharedSDK.chatExtendManager pinItemForMessage:message] != nil;
//    NSString *pinTitle = isMessagePined ? @"Un-pin": @"Pin";
//    NSString *pinAction = isMessagePined ? @"onTapMenuItemUnpin:" : @"onTapMenuItemPin:";
//    ChangeMax *pin = [ChangeMax item:pinAction
//                               normalImage:[UIImage imageNamed:@"menu_pin"]
//                             selectedImage:nil
//                                     title:pinTitle];

    //: FFFMediaItem *report = [FFFMediaItem item:@"onTapMenuItemReport:"
    ChangeMax *report = [ChangeMax show:StringFromMarginCocaineData(kStr_assaultValue)
                                  //: normalImage:[UIImage imageNamed:@"menu_report"]
                                  that:[UIImage imageNamed:StringFromMarginCocaineData(kStr_messageLeaseData)]
                                //: selectedImage:nil
                                from:nil
                                        //: title:[FFFLanguageManager getTextWithKey:@"report_Content"]];
                                        tillTing:[TeamManager sizeKey:StringFromMarginCocaineData(kStr_stareDireName)]];

    //: FFFMediaItem *translation = [FFFMediaItem item:@"onTapMenuItemTranslation:"
    ChangeMax *translation = [ChangeMax show:StringFromMarginCocaineData(kStr_gangQuickData)
                                  //: normalImage:[UIImage imageNamed:@"menu_translation"]
                                  that:[UIImage imageNamed:StringFromMarginCocaineData(kStr_automatName)]
                                //: selectedImage:nil
                                from:nil
                                        //: title:[FFFLanguageManager getTextWithKey:@"翻译"]];
                                        tillTing:[TeamManager sizeKey:@"翻译"]];

    //: FFFMediaItem *revoke = [FFFMediaItem item:@"onTapMenuItemRevoke:"
    ChangeMax *revoke = [ChangeMax show:StringFromMarginCocaineData(kStr_intentionData)
                                  //: normalImage:[UIImage imageNamed:@"menu_revoke"]
                                  that:[UIImage imageNamed:StringFromMarginCocaineData(kStr_bishopPureValue)]
                                //: selectedImage:nil
                                from:nil
                                        //: title:[FFFLanguageManager getTextWithKey:@"撤回"]];
                                        tillTing:[TeamManager sizeKey:@"撤回"]];

    //: FFFMediaItem *delete = [FFFMediaItem item:@"onTapMenuItemDelete:"
    ChangeMax *delete = [ChangeMax show:StringFromMarginCocaineData(kStr_albumWithValue)
                                  //: normalImage:[UIImage imageNamed:@"menu_del"]
                                  that:[UIImage imageNamed:StringFromMarginCocaineData(kStr_reluctantTitle)]
                                //: selectedImage:nil
                                from:nil
                                        //: title:[FFFLanguageManager getTextWithKey:@"删除"]];
                                        tillTing:[TeamManager sizeKey:@"删除"]];

//    ChangeMax *mutiSelect = [ChangeMax item:@"onTapMenuItemMutiSelect:"
//                                      normalImage:[UIImage imageNamed:@"menu_choose"]
//                                    selectedImage:nil
//                                            title:LangKey(@"多选")];

    //: [items addObject:Praise];
    [items addObject:Praise];

    //: if ([NTESSessionUtil canMessageBeForwarded:message])
    if ([LinkUtil tingEnableCancel:message])
    {
        //: [items addObject:reply];
        [items addObject:reply];
    }

    //: BOOL isMe = [message.from isEqualToString:[NIMSDK sharedSDK].loginManager.currentAccount];
    BOOL isMe = [message.from isEqualToString:[NIMSDK sharedSDK].loginManager.currentAccount];
    //: if (!isMe)
    if (!isMe)
    {
        //: [items addObject:report];
        [items addObject:report];
    }

    //: if (message.messageType == NIMMessageTypeText)
    if (message.messageType == NIMMessageTypeText)
    {
        //: [items addObject:copy];
        [items addObject:copy];
    }

    //: if ([NTESSessionUtil canMessageBeForwarded:message]) {
    if ([LinkUtil tingEnableCancel:message]) {
        //: [items addObject:forword];
        [items addObject:forword];
    }
//    if ([LinkUtil canMessageBeForwarded:message]) {
//        [items addObject:mark];
//        [items addObject:pin];
//    }
    //: if (message.messageType == NIMMessageTypeText){
    if (message.messageType == NIMMessageTypeText){
        //: [items addObject:translation];
        [items addObject:translation];
    }
    //: if ([NTESSessionUtil canMessageBeRevoked:message]) {
    if ([LinkUtil key:message]) {
        //: [items addObject:revoke];
        [items addObject:revoke];
    }



//    [items addObject:delete];

//    if ([LinkUtil canMessageBeForwarded:message])
//    {
//        [items addObject:mutiSelect];
//    }

//    if (message.messageType == NIMMessageTypeAudio)
//    {
//        ChangeMax *audio2text = [ChangeMax item:@"onTapMenuItemAudio2Text:"
//          normalImage:[UIImage imageNamed:@"menu_audio2text"]
//        selectedImage:nil
//                title:@"转文字".ntes_localized];
//
//        [items addObject:audio2text];
//    }
    //: return items;
    return items;
}

//: - (NSArray *)emotionItems
- (NSArray *)managerSend
{
    //NSArray *indexs = @[@(1),@(145),@(12),@(15),@(10),@(18),@(19)];
    //: NSArray *indexs = @[];
    NSArray *indexs = @[];
    //: NSMutableArray *items = [NSMutableArray array];
    NSMutableArray *items = [NSMutableArray array];
    //: for (NSNumber *index in indexs)
    for (NSNumber *index in indexs)
    {
        //: NSString * ID = [NSString stringWithFormat:NIMKitQuickCommentFormat, [index integerValue]];
        NSString * ID = [NSString stringWithFormat:let_tableKitContent, [index integerValue]];
        //: NIMInputEmoticon *item = [[FFFInputEmoticonManager sharedManager] emoticonByID:ID];
        CellEmoticon *item = [[AppManager administrator] colorId:ID];
        //: if (item)
        if (item)
        {
            //: [items addObject:item];
            [items addObject:item];
        }
    }

    //: return [items copy];
    return [items copy];
}

//: - (BOOL)shouldHandleReceipt{
- (BOOL)indexChange{
    //: return YES;
    return YES;
}

//: - (NSArray<NSNumber *> *)inputBarItemTypes{
- (NSArray<NSNumber *> *)upwardsCell{
    //: return @[
    return @[
//        @(ViewInputBarItemTypeMore),
//        @(ViewInputBarItemTypeEmoticon),
//             @(ViewInputBarItemTypeVoice),
             //: @(ViewInputBarItemTypeTextAndRecord),
             @(ViewInputBarItemTypeTextAndRecord),
        //: @(ViewInputBarItemTypeSend),
        @(ViewInputBarItemTypeSend),
            //: ];
            ];
}

//: - (BOOL)shouldHandleReceiptForMessage:(NIMMessage *)message
- (BOOL)withsing:(NIMMessage *)message
{
    //文字，语音，图片，视频，文件，地址位置和自定义消息都支持已读回执，其他的不支持
    //: NIMMessageType type = message.messageType;
    NIMMessageType type = message.messageType;
    //: if (type == NIMMessageTypeCustom) {
    if (type == NIMMessageTypeCustom) {
        //: NIMCustomObject *object = (NIMCustomObject *)message.messageObject;
        NIMCustomObject *object = (NIMCustomObject *)message.messageObject;
        //: id attachment = object.attachment;
        id attachment = object.attachment;

        //: if ([attachment isKindOfClass:[NTESWhiteboardAttachment class]]) {
        if ([attachment isKindOfClass:[PastAttachment class]]) {
            //: return NO;
            return NO;
        }
    }



    //: return type == NIMMessageTypeText ||
    return type == NIMMessageTypeText ||
    //: type == NIMMessageTypeAudio ||
    type == NIMMessageTypeAudio ||
    //: type == NIMMessageTypeImage ||
    type == NIMMessageTypeImage ||
    //: type == NIMMessageTypeVideo ||
    type == NIMMessageTypeVideo ||
    //: type == NIMMessageTypeFile ||
    type == NIMMessageTypeFile ||
    //: type == NIMMessageTypeLocation ||
    type == NIMMessageTypeLocation ||
    //: type == NIMMessageTypeCustom;
    type == NIMMessageTypeCustom;
}

//: - (NSArray<NIMInputEmoticonCatalog *> *)charlets
- (NSArray<ShowRecent *> *)showRender
{
    //: return nil;
    return nil;
}

//: - (BOOL)disableProximityMonitor{
- (BOOL)individualIcon{
    //: return [[NTESBundleSetting sharedConfig] disableProximityMonitor];
    return [[PinStyle shared] individualIcon];
}

//: - (BOOL)autoFetchAttachment {
- (BOOL)victualerDisable {
    //: return [[NTESBundleSetting sharedConfig] autoFetchAttachment];
    return [[PinStyle shared] victualerDisable];
}

//: - (NIMAudioType)recordType
- (NIMAudioType)containerLinkType
{
    //: return [[NTESBundleSetting sharedConfig] usingAmr] ? NIMAudioTypeAMR : NIMAudioTypeAAC;
    return [[PinStyle shared] atWith] ? NIMAudioTypeAMR : NIMAudioTypeAAC;
}

//: - (BOOL)disableSelectedForMessage:(NIMMessage *)message {
- (BOOL)visualCommunication:(NIMMessage *)message {
    //: return ![NTESSessionUtil canMessageBeForwarded:message];
    return ![LinkUtil tingEnableCancel:message];
}

//: - (void)setThreadMessage:(NIMMessage *)message
- (void)setThreadMessage:(NIMMessage *)message
{
    //: _threadMessage = message;
    _threadMessage = message;
}

//: - (void)cleanThreadMessage
- (void)input
{
    //: _threadMessage = nil;
    _threadMessage = nil;
}

//: - (BOOL)clearThreadMessageAfterSent
- (BOOL)administrativeDivision
{
    //: return YES;
    return YES;
}

//: @end
@end

Byte * MarginCocaineDataToCache(Byte *data) {
    int climbGradual = data[0];
    int earn = data[1];
    Byte monthly = data[2];
    int backShould = data[3];
    if (!climbGradual) return data + backShould;
    for (int i = backShould; i < backShould + earn; i++) {
        int value = data[i] - monthly;
        if (value < 0) {
            value += 256;
        }
        data[i] = value;
    }
    data[0] = 0;
    data[backShould + earn] = 0;
    return data + backShould;
}

NSString *StringFromMarginCocaineData(Byte *data) {
    return [NSString stringWithUTF8String:(char *)MarginCocaineDataToCache(data)];
}
